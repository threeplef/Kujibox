<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>쿠지박스</title>
    <link rel="stylesheet" href="style.css" />
    <link rel="icon" type="image/png" href="./images/favicon.png" />
  </head>

  <body>
    <!-- <header>
      <div class="brand">
        <div style="display: flex; align-items: center; gap: 10px">
          <div style="text-align: center">
            <img src="./images/logo.png" style="width: 18%" />
          </div>
        </div>
      </div>
    </header> -->

    <main>
      <div class="layout">
        <!-- LEFT: PRIZE LIST -->
        <!-- <section class="panel">
          <div class="top-actions">
            <h3>상품 목록</h3>
            <button class="ghost1" id="btnOpenSettings">설정</button>
          </div>
          <div class="content">
            <div class="muted" style="font-size: 12px; margin-bottom: 12px">
              ※ 상품 목록 변경 가능 / 중간에 추가 가능
            </div>
            <div id="prizeList"></div>
          </div>
        </section> -->
        <!-- LEFT: PRIZE BOARD -->
        <section class="panel prize-panel">
          <div class="content">
            <!-- 상단 메인 피규어(설정에서 변경 가능) -->
            <div class="left-hero">
              <div class="left-hero-text">
                <div class="logo-wrap">
                  <img
                    src="./images/logo2.png"
                    class="logo-img"
                    style="width: 230px"
                  />
                  <div
                    class="logo-text black-han-sans-regular"
                    id="logoText"
                  ></div>
                </div>

                <div class="top-actions1">
                  <button class="ghost2" id="btnOpenSettings">
                    상품 목록 설정
                  </button>
                </div>
              </div>

              <div class="left-hero-figure">
                <img
                  id="heroImg"
                  src="./images/lo.png"
                  alt="메인 피규어"
                  loading="lazy"
                />
                <div class="hero-label">
                  <span class="hero-chip" id="heroCode">L.O</span>
                  <span class="hero-name" id="heroName">코토부키야 네즈코</span>
                </div>
              </div>
            </div>

            <div id="prizeList" class="prize-grid"></div>
          </div>
        </section>

        <!-- CENTER: GRID -->
        <section
          style="
            display: flex;
            flex-direction: column;
            gap: 12px;
            overflow-y: auto;
            overscroll-behavior: contain;
          "
        >
          <div class="center-top">
            <div class="input">
              <input
                id="nameInput"
                type="text"
                placeholder="추첨자 이름 입력 후 Enter"
                autocomplete="off"
              />
            </div>

            <button class="primary" id="btnStart">시작</button>
            <button class="ghost" id="btnResetSession">초기화</button>
            <div class="status" id="statusLine">
              상태: <strong id="statusText">대기</strong>
              <span class="badge" id="currentNameBadge">이름 없음</span>
            </div>

            <div
              style="
                display: flex;
                gap: 8px;
                align-items: center;
                min-width: 240px;
              "
            >
              <label
                style="
                  font-size: 12px;
                  color: #444;
                  font-weight: 900;
                  white-space: nowrap;
                "
                >총 쿠지</label
              >
              <input
                id="totalInput"
                type="number"
                min="1"
                step="1"
                style="max-width: 120px"
              />
              <button class="ghost" id="btnRebuild">재생성</button>
              <button class="ghost" id="btnToggleHistory">기록 보기</button>
            </div>
          </div>

          <div class="grid-wrap">
            <div class="muted" style="font-size: 12px; margin: 0 0 12px">
              <span class="badge">규칙</span> 이름이 “기록 중” 상태일 때만
              쿠지를 깔 수 있어요. (초기화하면 이름만 지워지고 기록은 유지)
            </div>
            <div class="grid" id="grid"></div>
          </div>
        </section>

        <!-- RIGHT: HISTORY -->
        <!-- <section class="panel history-panel">
          <div class="top-actions">
            <h3>기록</h3>
            <button class="ghost1" id="btnDownload">기록 다운로드</button>
          </div>
          <div class="content">
            <div class="muted" style="font-size: 12px; margin-bottom: 10px">
              오픈:
              <span class="badge" id="histCount">0</span>
              &nbsp;&nbsp;|&nbsp;&nbsp; 남은 쿠지:
              <span class="badge" id="remainingCount">0</span>
            </div>
            <table>
              <thead>
                <tr>
                  <th style="width: 72px">이름</th>
                  <th>번호</th>
                </tr>
              </thead>
              <tbody id="historyBody"></tbody>
            </table>
          </div>
        </section> -->
      </div>

      <!-- HISTORY MODAL -->
      <div class="modal hidden" id="historyModal" aria-hidden="true">
        <div
          class="modal-card history-modal-card"
          role="dialog"
          aria-modal="true"
        >
          <div class="modal-head">
            <h3>기록</h3>
            <button class="ghost1" id="btnCloseHistoryModal">닫기</button>
          </div>

          <div class="modal-body history-modal-body">
            <div
              class="top-actions"
              style="border-bottom: none; padding: 0; margin-bottom: 10px"
            >
              <div class="muted" style="font-size: 12px">
                오픈:
                <span class="badge" id="histCountModal">0</span>
                &nbsp;&nbsp;|&nbsp;&nbsp; 남은 쿠지:
                <span class="badge" id="remainingCountModal">0</span>
              </div>
              <button class="ghost1" id="btnDownloadModal">
                기록 다운로드
              </button>
            </div>

            <table>
              <thead>
                <tr>
                  <th style="width: 72px">이름</th>
                  <th>번호</th>
                </tr>
              </thead>
              <tbody id="historyBodyModal"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- SETTINGS MODAL -->
      <div class="modal hidden" id="settingsModal" aria-hidden="true">
        <div
          class="modal-card"
          role="dialog"
          aria-modal="true"
          aria-labelledby="settingsTitle"
        >
          <div class="modal-head">
            <h3 id="settingsTitle">설정</h3>
            <button class="ghost1" id="btnCloseSettings">닫기</button>
          </div>

          <div class="modal-body">
            <div class="cfg-grid">
              <!-- 번호 풀 -->
              <!-- <div class="cfg-block">
                <div class="cfg-title">당첨 번호(번호 풀)</div>
                <div class="muted" style="font-size: 12px; margin-bottom: 8px">
                  ① 비워두면 “1 ~ 총 쿠지”가 자동으로 랜덤 배정됩니다.<br />
                  ② 직접 지정하려면 아래에서 “추가”로 번호들을 만들고
                  저장하세요.
                </div>

                <div class="cfg-row">
                  <input id="poolSingle" type="number" placeholder="번호 1개" />
                  <button class="ghost" id="btnPoolAddSingle">추가</button>
                </div>

                <div class="cfg-row">
                  <input id="poolFrom" type="number" placeholder="시작" />
                  <input id="poolTo" type="number" placeholder="끝" />
                  <button class="ghost" id="btnPoolAddRange">구간 추가</button>
                </div>

                <div class="cfg-row">
                  <button class="ghost" id="btnPoolClear">전체 비우기</button>
                </div>

                <div class="pool-chips" id="poolChips"></div>

                // 기존 textarea는 숨김 저장용(로직 호환용) 
                <textarea
                  id="settingsNumbers"
                  class="ta hidden"
                  rows="4"
                ></textarea>
              </div> -->

              <!-- 상품 목록 -->
              <div class="cfg-row">
                <input
                  type="text"
                  id="logoTextInput"
                  placeholder="해당 자체쿠지가 몇 탄인지 작성해주세요."
                />
              </div>
              <div class="cfg-block">
                <div class="cfg-title">상품 목록 설정</div>
                <div class="muted" style="font-size: 12px; margin-bottom: 8px">
                  번호/이름/이미지를 바꾸면 왼쪽 상단 피규어 영역이 바뀝니다.
                </div>

                <div class="cfg-row">
                  <button class="ghost" id="btnPrizeAddRow">+ 상품 추가</button>
                </div>

                <div class="prize-editor">
                  <div class="prize-head">
                    <div>번호</div>
                    <div>상품명</div>
                    <div>이미지</div>
                    <div>수량</div>
                    <div></div>
                  </div>
                  <div id="prizeRows"></div>
                </div>

                <!-- 기존 JSON textarea는 숨김 저장용(로직 호환용) -->
                <textarea
                  id="settingsPrizes"
                  class="ta hidden"
                  rows="10"
                ></textarea>
              </div>

              <!-- <div class="cfg-row">
                <input
                  id="heroCodeInput"
                  type="text"
                  placeholder="번호 (예: L.O)"
                />
                <input
                  id="heroNameInput"
                  type="text"
                  placeholder="상품명 (예: 코토부키야 네즈코)"
                />
              </div>
              <div class="cfg-row">
                <input
                  id="heroImgInput"
                  type="text"
                  placeholder="이미지 경로 (예: ./images/hero.png)"
                />
              </div> -->
              <div class="cfg-row1">
                <input id="heroCodeInput" type="text" placeholder="L.O" />
                <input id="heroNameInput" type="text" placeholder="상품명" />
              </div>

              <div class="cfg-row2">
                <input
                  type="text"
                  id="heroImgInput"
                  placeholder="이미지 경로 또는 파일 선택"
                />

                <button class="ghost" type="button" id="btnHeroPickFile">
                  파일
                </button>

                <input
                  type="file"
                  id="heroFileInput"
                  accept="image/*"
                  style="display: none"
                />
              </div>
            </div>

            <div class="modal-actions">
              <button class="primary" id="btnSaveSettings">저장</button>
            </div>

            <!-- <div class="muted" style="font-size: 12px">
              ※ 상품목록을 현재 쿠지에 반영하려면 저장 시 확인 후
              재생성됩니다(기록은 유지).
            </div> -->
          </div>
        </div>
      </div>

      <!-- KUJI OPEN MODAL -->
      <div class="modal hidden" id="kujiOpenModal" aria-hidden="true">
        <div class="modal-card kuji-open-card" role="dialog" aria-modal="true">
          <div class="modal-head">
            <h3>쿠지 오픈</h3>
            <button class="ghost1" id="btnCloseKujiOpen">닫기</button>
          </div>

          <div class="modal-body">
            <div class="kuji-open-stage" id="kujiOpenStage">
              <!-- 선택한 "그 쿠지"가 크게 보이는 영역 -->
              <!-- 숫자(아래 깔림) -->
              <div class="kuji-under" id="kujiUnder">
                <div class="kuji-under-reveal" id="kujiUnderReveal">
                  <div class="kuji-under-number" id="kujiUnderNumber"></div>
                </div>
              </div>

              <!-- 종이(위 덮임) -->
              <div class="kuji kuji-open-sheet" id="kujiOpenSheet"></div>

              <div class="kuji-open-hint" id="kujiOpenHint">
                왼쪽 → 오른쪽으로 드래그해서 까세요
              </div>
            </div>

            <!-- ✅ 당첨 결과 (당첨 번호일 때만 표시) -->
            <!-- <div class="win-result hidden" id="winResult" aria-live="polite">
              <div class="win-row">
                <div class="win-thumb">
                  <img id="winPrizeImg" alt="당첨 상품 이미지" />
                </div>
                <div class="win-meta">
                  <div class="win-num" id="winPrizeNum"></div> 
                  <div class="win-badge">🎉 당첨!</div>
                  <div class="win-name" id="winPrizeName"></div>
                  <div class="win-note muted" id="winPrizeNote"></div> 
                </div>
              </div>
            </div> -->
          </div>
        </div>
      </div>

      <!-- ✅ 당첨 오버레이: 모달 카드 바깥(=모달 전체 기준) -->
      <div
        class="win-overlay hidden"
        id="winResult"
        aria-live="polite"
        role="dialog"
        aria-modal="true"
      >
        <div class="win-overlay-backdrop" id="winOverlayBackdrop"></div>
        <!-- ✅ 폭죽: 당첨 카드보다 위 레이어 -->
        <canvas class="confetti-canvas-overlay" id="confettiCanvas"></canvas>
        <div class="win-card">
          <div class="win-card-head">
            <div class="win-badge"></div>
            <button class="ghost1" type="button" id="btnCloseWinOverlay">
              X
            </button>
          </div>

          <!-- ✅ 세로 레이아웃: 이미지 위, 텍스트 아래 -->
          <div class="win-col">
            <div class="win-thumb">
              <img id="winPrizeImg" alt="당첨 상품 이미지" />
            </div>
            <div class="win-meta">
              <div class="win-num" id="winPrizeNum"></div>
              <div class="win-name" id="winPrizeName"></div>
              <div class="win-note muted" id="winPrizeNote"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- CUSTOM ALERT MODAL -->
      <div class="modal hidden" id="alertModal" aria-hidden="true">
        <div class="modal-card alert-card" role="dialog" aria-modal="true">
          <div class="modal-head">
            <h3 id="alertTitle">알림</h3>
            <button class="ghost1" id="btnCloseAlert">닫기</button>
          </div>

          <div class="modal-body">
            <div id="alertMessage" class="alert-message"></div>
            <!-- <div class="modal-actions">
              <button class="primary" id="btnOkAlert">확인</button>
            </div> -->
          </div>
        </div>
      </div>

      <!-- CUSTOM CONFIRM MODAL -->
      <div class="modal hidden" id="confirmModal" aria-hidden="true">
        <div class="modal-card alert-card" role="dialog" aria-modal="true">
          <div class="modal-head">
            <h3 id="confirmTitle">확인</h3>
          </div>

          <div class="modal-body">
            <div id="confirmMessage" class="alert-message"></div>

            <div class="modal-actions" style="gap: 8px">
              <button class="ghost" id="btnCancelConfirm">취소</button>
              <button class="primary" id="btnOkConfirm">확인</button>
            </div>
          </div>
        </div>
      </div>

      <!-- ACCESS CODE MODAL -->
      <div class="modal hidden" id="accessModal" aria-hidden="true">
        <div class="modal-card access-card" role="dialog" aria-modal="true">
          <div class="modal-head">
            <h3>입장 코드</h3>
            <!-- 닫기 버튼 없음(코드 입력 전엔 사용 못 하게) -->
          </div>

          <div class="modal-body">
            <p class="muted" style="margin: 0 0 10px">
              코드를 입력해야 쿠지박스를 사용할 수 있어요.
            </p>

            <div class="access-row">
              <input
                id="accessInput"
                class="input1"
                type="password"
                placeholder="입장 코드 입력"
                autocomplete="off"
              />
              <button id="btnAccessEnter" class="primary">입장</button>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- TOAST -->
    <div id="toast" class="toast hidden"></div>

    <script type="module" src="script.js"></script>

    <!-- SheetJS (xlsx) for Excel download -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  </body>
</html>
